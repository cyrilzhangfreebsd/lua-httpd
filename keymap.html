<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Install FreeBSD</title>
		<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">
			<link rel="stylesheet" href="https://unpkg.com/bulmaswatch/{{theme}}/bulmaswatch.min.css"> -->
	</head>
	<body>
		<script>

			function setLayout () {
				let layout = document.getElementById("keymap").value;
				let variant = document.getElementById("variants").value;
				fetch("/keymap", {
					method : 'POST',
					body : JSON.stringify({"layout" : layout, "variant" : variant})
				}).then(data => 
					data.text().then(console.log));
			}

			function showVariants (text) {
				let variant_selector = document.getElementById("variants");
				let variants = JSON.parse(text);

				variant_selector.textContent = "";

				let default_option = document.createElement("option");
				default_option.value = "";
				default_option.innerHTML = "(none)";
				variant_selector.appendChild(default_option);

				for (let i = 0; i < variants.length; ++i) {
					let option = document.createElement("option");
					option.value = variants[i].variant;
					option.innerHTML = variants[i].desc;
					variant_selector.appendChild(option);
				}

				setLayout();
			}

			function getVariants (e) {
				let layout = e.target.value;
				fetch("/keymap/variants/" + layout).then(data =>
					data.text().then(showVariants)); 
			}

			function startup () {
				console.log("testing");

				let layout_select = document.getElementById("keymap");
				layout_select.addEventListener("change", getVariants); 

				let variant_select = document.getElementById("variants");
				variant_select.addEventListener("change", setLayout); 
			}
			window.addEventListener("load", startup);

		</script>
		<div class="columns is-centered">
			<div class="column is-narrow">

				<h1 class="title">Configure your Keyboard</h1>

				<form action="/keyboard" method="POST">
					<div class="field">
						<label class="label">{{keymap_menu[lang]}}:</label>
						<div class="control">
							<div class="select">
								<select id="keymap" name="keymap">
									{% for _, map in ipairs(keymap_x_list) do %}
									<option value="{{map.layout}}">{{map.desc}}</option>
									{% end %}
								</select>
							</div>
						</div>
					</div>

					<div class="field">
						<label class="label">Select the variant:</label>
						<div class="control">
							<div class="select">
								<select id="variants" name="variants">
								</select>
							</div>
						</div>
					</div>

					<textarea placeholder="test your keyboard here..." class="textarea" rows=5 cols=40></textarea>
				</form>
			</div>
		</div>
	</body>
</html>
